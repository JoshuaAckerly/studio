name: Pester tests (Windows)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  pester-windows:
    name: Run Pester tests on Windows
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure Git
        run: |
          git config --global user.email "ci@example.com"
          git config --global user.name "CI Runner"
          git config --global core.autocrlf false

      - name: Install Pester
        shell: pwsh
        run: |
          # Install Pester non-interactively for the current user
          Install-Module -Name Pester -Force -Scope CurrentUser -MinimumVersion 5.0 -AllowClobber -Confirm:$false -ErrorAction Stop

      - name: Run Pester
        shell: pwsh
        run: |
          # Run the Pester test suite located under tests/Pester
          Invoke-Pester -Script .\tests\Pester
